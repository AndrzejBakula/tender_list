{% extends "base.html" %}
{% load static %}

{% block title %} Szczegóły Przetargu {% endblock %}

{% block content %}

<div class="d-flex flex-column align-items-center" style="height: 100%; width: 100%;">
    <div class="d-flex flex-row justify-content-center align-items-center">
        <h2 class="display-5 align-self-center header2"><i>Szczegóły Przetargu</i></h2>
    </div>

    <div class="d-flex flex-column align-items-center">
        <table class="table table-striped table-bordered">
            <tbody>
                <tr>
                    <th scope="col">Nazwa projektu</th>
                    <td scope="col">{{ tender.project.project_name }}</td>
                </tr>
                <tr>
                    <th scope="col">Inwestor</th>
                    <td scope="col">{{ tender.project.investor.investor_name }}</td>
                </tr>
                <tr>
                    <th scope="col">Kwota zamawiającego</th>
                    <td scope="col">
                        {% if tender.investor_budget %}
                            {{ tender.investor_budget }} zł brutto
                        {% else %}
                            nieokreślono
                        {% endif %}
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <table class="table-responsive-xl table-striped table-bordered" style="width: 100%;">
        <thead>
            <tr>
                <th scope="col" style="text-align: center;">Oferent</th>
                <th scope="col" style="text-align: center;">Cena</th>
                {% if tender.is_guarantee %}
                <th scope="col" style="text-align: center;">Gwarancja</th>
                {% endif %}
                {% if tender.is_deadline %}
                <th scope="col" style="text-align: center;">Termin</th>
                {% endif %}
                {% for i in tender.other_criteria.all %}
                <th scope="col" style="text-align: center;">{{ i.criteria_name }}</th>
                {% endfor %}
            </tr>
        </thead>
        <tbody>
            {% for i in tenderers %}
            {% if i.is_winner and i.tenderer.division_company %}
            <tr style="color: red; background-color: lightblue;">
            {% elif i.is_winner %}
            <tr style="color: red;">
            {% elif i.tenderer.division_company %}
            <tr style="background-color: lightblue;">
            {% else %}
            <tr>
            {% endif %}
                <td scope="col" style="text-align: center;">
                    <a href="{% url 'company-details' i.tenderer.id %}">{{ i.tenderer.company_name }}</a>
                    {% if not i.is_winner and not winner %}
                    <a href="{% url 'make-winner' tender.id i.id %}"> (Oznacz jako wygranego)</a>
                    {% elif i.is_winner %}
                    WYGRANY!
                    <a href="{% url 'remove-winner' tender.id i.id %}">(Zmień)</a>
                    {% endif %}
                </td>
                <td scope="col" style="text-align: center;">{{ i.offer_value }}</td>
                {% if i.offer_guarantee %}
                <td scope="col" style="text-align: center;">{{ i.offer_guarantee }} mies.</td>
                {% endif %}
                {% if i.offer_deadline %}
                <td scope="col" style="text-align: center;">{{ i.offer_deadline }}</td>
                {% endif %}
                {% for j in i.other_criteria.all %}
                <td scope="col" style="text-align: center;">{{ j.criteria_value }}</td>
                {% endfor %}
            </tr>


            {% endfor %}
        </tbody>
    </table>
    {% if user.is_staff and request.session.division_id in divisions %}
    <hr>
    <button type="button" class="btn btn-dark"><a style="color:blanchedalmond"
    href="{% url 'edit-tender' project.id tender.id %}">Edytuj Przetarg</a></button>
    {% if user.is_superuser %}
    <hr>
    <button type="button" class="btn btn-dark"><a style="color:blanchedalmond"
    href="{% url 'delete-tender' project.id tender.id %}">Usuń Przetarg</a></button>
    {% endif %}
    {% endif %}
    
</div>

{% endblock %}